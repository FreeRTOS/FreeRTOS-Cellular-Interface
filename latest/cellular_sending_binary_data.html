<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FreeRTOS: FreeRTOS Cellular Library: Sending binary data with Cellular Common APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FreeRTOS: FreeRTOS Cellular Library<span id="projectnumber">&#160;v1.4.0</span>
   </div>
   <div id="projectbrief">FreeRTOS Cellular Library</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cellular_sending_binary_data.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Sending binary data with Cellular Common APIs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Send binary data command is split into two steps:</p>
<ul>
<li><b>Send the AT command</b></li>
<li><b>Send the binary data</b></li>
</ul>
<p>Take the socket send command of reference port BG96 for example: </p><div class="fragment"><div class="line">AT+QISEND=0,5 <span class="comment">//Send fixed length data and the data length is 5 bytes</span></div>
<div class="line">&gt; test2</div>
<div class="line">SEND OK</div>
</div><!-- fragment --><p>The first step sends the command "AT+QISEND=0,5" and waiting for the response "&gt; ". </p><div class="fragment"><div class="line">AT+QISEND=0,5</div>
<div class="line">&gt;</div>
</div><!-- fragment --><p> "&gt;" is a result code in the port to indicate that modem is ready to accept the binary data.</p>
<p>The second step send the binary data "test2" to the modem and waits for the response "SEND OK". </p><div class="fragment"><div class="line">test2</div>
<div class="line">SEND OK</div>
</div><!-- fragment --><p> "SEND OK" is a result code in the port to indicate the modem successfully receives the data.</p>
<blockquote class="doxtable">
<p>&zwj;One thing to mentioned in the example is that cellular interface processes the response in line. The respone "&gt; " does not contain line ending char. Cellular interface passes the response to the port through data send prefix callback function. The port may fix the input stream in the callback function. In this example, the response is fixed to "&gt;\n" in the callback. Cellular interface can process the fixed input stream. </p>
</blockquote>
<p>_Cellular_AtcmdDataSend is the general cellular common API to send binary data to cellular modem. BG96 port make use of this API to send binary data with the following parameters:</p>
<div class="fragment"><div class="line"><span class="comment">/* The structure to send the AT command. Mapping to the first step of send binary data. */</span></div>
<div class="line"><a class="code hl_struct" href="struct_cellular_at_req__t.html">CellularAtReq_t</a> atReqSocketSend =</div>
<div class="line">{</div>
<div class="line">    .<a class="code hl_variable" href="struct_cellular_at_req__t.html#a78daaea1eb323c2e788003c009d504ec">pAtCmd</a> = cmdBuf,                    <span class="comment">/* In this example, &quot;AT+QISEND=0,5&quot;. */</span></div>
<div class="line">    .atCmdType = <a class="code hl_enumvalue" href="group__cellular__datatypes__enums.html#gga22b54dbb4c2baa273b36bb7fc63bf372a11bd777d889f076a3314ec918e5d1f4f">CELLULAR_AT_NO_RESULT</a>,  <span class="comment">/* The command expects only result code to indicate status from modem. */</span></div>
<div class="line">    .pAtRspPrefix = NULL,                <span class="comment">/* No prefix for the result since the type is CELLULAR_AT_NO_RESULT. */</span></div>
<div class="line">    .respCallback = NULL,                <span class="comment">/* No response callback since the type is CELLULAR_AT_NO_RESULT. */</span></div>
<div class="line">    .pData = NULL,                       <span class="comment">/* No data since the type is CELLULAR_AT_NO_RESULT. */</span></div>
<div class="line">    .dataLen = 0,                        <span class="comment">/* Data length is 0. */</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* The structure to send the binary data. Mapping to the second step of send binary data. */</span></div>
<div class="line"><a class="code hl_struct" href="struct_cellular_at_data_req__t.html">CellularAtDataReq_t</a> atDataReqSocketSend =</div>
<div class="line">{</div>
<div class="line">    .<a class="code hl_variable" href="struct_cellular_at_data_req__t.html#a410fec7ac962fd6c98eff0f76a5c104a">pData</a> = pData,                      <span class="comment">/* Point to the data to send. */</span></div>
<div class="line">    .dataLen = dataLength,               <span class="comment">/* The length of the data to send. */</span></div>
<div class="line">    .pSentDataLength = pSentDataLength,  <span class="comment">/* The actual data sent to the modem. */</span></div>
<div class="line">    .pEndPattern = NULL,                 <span class="comment">/* The end pattern to send after the binary data. */</span></div>
<div class="line">    .endPatternLen = 0                   <span class="comment">/* The length of the end pattern. */</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* The send binary data send API in cellular common layer. */</span></div>
<div class="line">pktStatus = <a class="code hl_function" href="cellular__common_8h.html#a94efed6f9dd70789b7039459ec348c3a">_Cellular_AtcmdDataSend</a>( pContext,                  <span class="comment">/* The cellular context. */</span></div>
<div class="line">                                     atReqSocketSend,           <span class="comment">/* Send AT command request. */</span></div>
<div class="line">                                     atDataReqSocketSend,       <span class="comment">/* Send binary data. */</span></div>
<div class="line">                                     socketSendDataPrefix,      <span class="comment">/* Data prefix callback. BG96 port fix the input stream &quot;&gt; &quot; in this function. */</span></div>
<div class="line">                                     NULL,                      <span class="comment">/* Data prefix callback context. Not used in this example. */</span></div>
<div class="line">                                     PACKET_REQ_TIMEOUT_MS,     <span class="comment">/* AT command send timeout. */</span></div>
<div class="line">                                     sendTimeout,               <span class="comment">/* Binary data send timeout. */</span></div>
<div class="line">                                     0U );                      <span class="comment">/* The delay between AT command and binary data. */</span></div>
<div class="ttc" id="acellular__common_8h_html_a94efed6f9dd70789b7039459ec348c3a"><div class="ttname"><a href="cellular__common_8h.html#a94efed6f9dd70789b7039459ec348c3a">_Cellular_AtcmdDataSend</a></div><div class="ttdeci">CellularPktStatus_t _Cellular_AtcmdDataSend(CellularContext_t *pContext, CellularAtReq_t atReq, CellularAtDataReq_t dataReq, CellularATCommandDataSendPrefixCallback_t pktDataSendPrefixCallback, void *pCallbackContext, uint32_t atTimeoutMS, uint32_t dataTimeoutMS, uint32_t interDelayMS)</div><div class="ttdoc">Send the AT command to cellular modem with send data.</div><div class="ttdef"><b>Definition:</b> cellular_pkthandler.c:668</div></div>
<div class="ttc" id="agroup__cellular__datatypes__enums_html_gga22b54dbb4c2baa273b36bb7fc63bf372a11bd777d889f076a3314ec918e5d1f4f"><div class="ttname"><a href="group__cellular__datatypes__enums.html#gga22b54dbb4c2baa273b36bb7fc63bf372a11bd777d889f076a3314ec918e5d1f4f">CELLULAR_AT_NO_RESULT</a></div><div class="ttdeci">@ CELLULAR_AT_NO_RESULT</div><div class="ttdef"><b>Definition:</b> cellular_types.h:361</div></div>
<div class="ttc" id="astruct_cellular_at_data_req__t_html"><div class="ttname"><a href="struct_cellular_at_data_req__t.html">CellularAtDataReq_t</a></div><div class="ttdoc">The data command request structure.</div><div class="ttdef"><b>Definition:</b> cellular_common.h:76</div></div>
<div class="ttc" id="astruct_cellular_at_data_req__t_html_a410fec7ac962fd6c98eff0f76a5c104a"><div class="ttname"><a href="struct_cellular_at_data_req__t.html#a410fec7ac962fd6c98eff0f76a5c104a">CellularAtDataReq_t::pData</a></div><div class="ttdeci">const uint8_t * pData</div><div class="ttdef"><b>Definition:</b> cellular_common.h:77</div></div>
<div class="ttc" id="astruct_cellular_at_req__t_html"><div class="ttname"><a href="struct_cellular_at_req__t.html">CellularAtReq_t</a></div><div class="ttdoc">The AT command request structure.</div><div class="ttdef"><b>Definition:</b> cellular_common.h:62</div></div>
<div class="ttc" id="astruct_cellular_at_req__t_html_a78daaea1eb323c2e788003c009d504ec"><div class="ttname"><a href="struct_cellular_at_req__t.html#a78daaea1eb323c2e788003c009d504ec">CellularAtReq_t::pAtCmd</a></div><div class="ttdeci">const char * pAtCmd</div><div class="ttdef"><b>Definition:</b> cellular_common.h:63</div></div>
</div><!-- fragment --><p>To adapt with various cellular modems AT command, cellular interface provides the following APIs in common layer to send binary stream to modem:</p><ul>
<li><a class="el" href="cellular__common_8h.html#a94efed6f9dd70789b7039459ec348c3a">_Cellular_AtcmdDataSend</a> : The general API to send the binary stream.</li>
<li><a class="el" href="cellular__common_8h.html#a230ced3dd2904993022838a4c03f2148">_Cellular_TimeoutAtcmdDataSendRequestWithCallback</a> : A compact version of _Cellular_AtcmdDataSend without pktDataSendPrefixCallback and interDelayMS parameters.</li>
<li><a class="el" href="cellular__common_8h.html#aaf7ae2f5719e8557449225c5f60f037e">_Cellular_TimeoutAtcmdDataSendSuccessToken</a> : An extension of _Cellular_TimeoutAtcmdDataSendRequestWithCallback with extra success token.</li>
</ul>
<p>HL7802 socket send command reference port example </p><div class="fragment"><div class="line">AT+KTCPSND=1,18</div>
<div class="line">CONNECT                 <span class="comment">// CONNECT is considered a success result code only when sending the AT+KTCPSND command</span></div>
<div class="line">                        <span class="comment">// _Cellular_TimeoutAtcmdDataSendSuccessToken can be used in this case.</span></div>
<div class="line">...Data send...</div>
<div class="line">--EOF--Pattern--        <span class="comment">// Modem required the end pattern sent after the binary data.</span></div>
<div class="line">                        <span class="comment">// The pEndPattern of CellularAtDataReq_t can be used in this case.</span></div>
<div class="line">OK</div>
</div><!-- fragment --><p>SARA-R4 socket send command reference port example </p><div class="fragment"><div class="line">AT+USOWR=3,16</div>
<div class="line">@16 bytes of data       <span class="comment">// &quot;@&quot; is not a new line. SARA-R4 port fixes the input stream in the callback.</span></div>
<div class="line">                        <span class="comment">// SARA-R4 requires to wait for a minimum of 50 ms before sending data.</span></div>
<div class="line">                        <span class="comment">// The interDelayMS parameter of _Cellular_AtcmdDataSend can be used in this case.</span></div>
<div class="line">+USOWR: 3,16</div>
<div class="line">OK</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
