<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FreeRTOS: FreeRTOS Cellular Library: Receiving binary data with Cellular Common APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FreeRTOS: FreeRTOS Cellular Library<span id="projectnumber">&#160;v1.4.0</span>
   </div>
   <div id="projectbrief">FreeRTOS Cellular Library</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cellular_receiving_binary_data.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Receiving binary data with Cellular Common APIs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Receive binary data command relies on the port to indicate start and length of the binary data in the input stream.</p>
<p>Take the socket receive command of reference port BG96 for example: </p><div class="fragment"><div class="line">AT+QIRD=11,1500         <span class="comment">// Read data received from incoming connection.</span></div>
<div class="line">+QIRD: 4                <span class="comment">// Actual data length is 4 bytes.</span></div>
<div class="line">test                    <span class="comment">// The binary data returns from the modem</span></div>
<div class="line">OK                      <span class="comment">// The success result code</span></div>
</div><!-- fragment --><p>The binary data "test" should not be parsed by cellular interface. The port needs to indicate the start of binary data and the length in data prefix callback function.</p>
<p>_Cellular_TimeoutAtcmdDataRecvRequestWithCallback is cellular common API to receive binary data from modem. BG96 port make use of this API to receive binary data with the following parameters:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_enumeration" href="group__cellular__datatypes__enums.html#ga21d0a7205b6ba28eccd8aa7782b16cda">CellularPktStatus_t</a> socketRecvDataPrefix( <span class="keywordtype">void</span> * pCallbackContext,   <span class="comment">/* Not used in this example. */</span></div>
<div class="line">                                                 <span class="keywordtype">char</span> * pLine,              <span class="comment">/* The input buffer with response from cellular modem. */</span></div>
<div class="line">                                                 uint32_t lineLength,       <span class="comment">/* The length of pLine. */</span></div>
<div class="line">                                                 <span class="keywordtype">char</span> ** ppDataStart,       <span class="comment">/* Start address of the binary data in pLine. */</span></div>
<div class="line">                                                 uint32_t * pDataLength );  <span class="comment">/* The length of the binary data. */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_enumeration" href="group__cellular__datatypes__enums.html#ga21d0a7205b6ba28eccd8aa7782b16cda">CellularPktStatus_t</a> _Cellular_RecvFuncData( CellularContext_t * pContext,                    <span class="comment">/* The cellular module context. */</span></div>
<div class="line">                                                   <span class="keyword">const</span> <a class="code hl_struct" href="struct_cellular_a_t_command_response__t.html">CellularATCommandResponse_t</a> * pAtResp,     <span class="comment">/* The response from cellular modem. */</span></div>
<div class="line">                                                   <span class="keywordtype">void</span> * pData,                                    <span class="comment">/* Point to dataRecv in this example. */</span></div>
<div class="line">                                                   uint16_t dataLen );                              <span class="comment">/* The length of the buffer pointed by &amp;pData. */</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="struct_cellular_at_req__t.html">CellularAtReq_t</a> atReqSocketRecv =</div>
<div class="line">{</div>
<div class="line">    .<a class="code hl_variable" href="struct_cellular_at_req__t.html#a78daaea1eb323c2e788003c009d504ec">pAtCmd</a> = cmdBuf,                               <span class="comment">/* In this example, AT+QIRD=11,1500. */</span></div>
<div class="line">    .atCmdType = <a class="code hl_enumvalue" href="group__cellular__datatypes__enums.html#gga22b54dbb4c2baa273b36bb7fc63bf372a95b2065a36ed6980d2f907f7db160bc8">CELLULAR_AT_MULTI_DATA_WO_PREFIX</a>,  <span class="comment">/* The command expects multiple line or data received. */</span></div>
<div class="line">    .pAtRspPrefix = <span class="stringliteral">&quot;+QIRD&quot;</span>,                        <span class="comment">/* The response prefix for this command. */</span></div>
<div class="line">    .respCallback = _Cellular_RecvFuncData,         <span class="comment">/* The callback function to parse the response from modem. */</span></div>
<div class="line">    .pData = ( <span class="keywordtype">void</span> * ) &amp;dataRecv,                  <span class="comment">/* The data pointer in the callback function. */</span></div>
<div class="line">    .dataLen = bufferLength                         <span class="comment">/* The length of the data pointer. */</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">pktStatus = <a class="code hl_function" href="cellular__common_8h.html#a5cdb1194f4558dfcd506d025df7cc0a4">_Cellular_TimeoutAtcmdDataRecvRequestWithCallback</a>( pContext,                <span class="comment">/* The cellular context pointer. */</span></div>
<div class="line">                                                               atReqSocketRecv,         <span class="comment">/* The AT command structure. */</span></div>
<div class="line">                                                               recvTimeout,             <span class="comment">/* Timeout value for this AT command. */</span></div>
<div class="line">                                                               socketRecvDataPrefix,    <span class="comment">/* The data prefix callback function. */</span></div>
<div class="line">                                                               NULL );                  <span class="comment">/* The context of the data prefix callback. */</span></div>
<div class="ttc" id="acellular__common_8h_html_a5cdb1194f4558dfcd506d025df7cc0a4"><div class="ttname"><a href="cellular__common_8h.html#a5cdb1194f4558dfcd506d025df7cc0a4">_Cellular_TimeoutAtcmdDataRecvRequestWithCallback</a></div><div class="ttdeci">CellularPktStatus_t _Cellular_TimeoutAtcmdDataRecvRequestWithCallback(CellularContext_t *pContext, CellularAtReq_t atReq, uint32_t timeoutMS, CellularATCommandDataPrefixCallback_t pktDataPrefixCallback, void *pCallbackContext)</div><div class="ttdoc">Send the AT command to cellular modem with data buffer response.</div><div class="ttdef"><b>Definition:</b> cellular_pkthandler.c:629</div></div>
<div class="ttc" id="agroup__cellular__datatypes__enums_html_ga21d0a7205b6ba28eccd8aa7782b16cda"><div class="ttname"><a href="group__cellular__datatypes__enums.html#ga21d0a7205b6ba28eccd8aa7782b16cda">CellularPktStatus_t</a></div><div class="ttdeci">CellularPktStatus_t</div><div class="ttdoc">packet Status Names.</div><div class="ttdef"><b>Definition:</b> cellular_types.h:338</div></div>
<div class="ttc" id="agroup__cellular__datatypes__enums_html_gga22b54dbb4c2baa273b36bb7fc63bf372a95b2065a36ed6980d2f907f7db160bc8"><div class="ttname"><a href="group__cellular__datatypes__enums.html#gga22b54dbb4c2baa273b36bb7fc63bf372a95b2065a36ed6980d2f907f7db160bc8">CELLULAR_AT_MULTI_DATA_WO_PREFIX</a></div><div class="ttdeci">@ CELLULAR_AT_MULTI_DATA_WO_PREFIX</div><div class="ttdef"><b>Definition:</b> cellular_types.h:366</div></div>
<div class="ttc" id="astruct_cellular_a_t_command_response__t_html"><div class="ttname"><a href="struct_cellular_a_t_command_response__t.html">CellularATCommandResponse_t</a></div><div class="ttdoc">Represents AT Command response.</div><div class="ttdef"><b>Definition:</b> cellular_types.h:483</div></div>
<div class="ttc" id="astruct_cellular_at_req__t_html"><div class="ttname"><a href="struct_cellular_at_req__t.html">CellularAtReq_t</a></div><div class="ttdoc">The AT command request structure.</div><div class="ttdef"><b>Definition:</b> cellular_common.h:62</div></div>
<div class="ttc" id="astruct_cellular_at_req__t_html_a78daaea1eb323c2e788003c009d504ec"><div class="ttname"><a href="struct_cellular_at_req__t.html#a78daaea1eb323c2e788003c009d504ec">CellularAtReq_t::pAtCmd</a></div><div class="ttdeci">const char * pAtCmd</div><div class="ttdef"><b>Definition:</b> cellular_common.h:63</div></div>
</div><!-- fragment --><p>The data receive callback <a class="el" href="cellular__common_8h.html#ac9ed75355d4bf632ec7e170066461fb6">CellularATCommandDataPrefixCallback_t</a>, socketRecvDataPrefix in this example, can return the following value to cellular interface library:</p><ul>
<li><b>CELLULAR_PKT_STATUS_OK</b> : Cellular interface libary should keep process the input buffer. The following data in the input buffer will be regarded as binary data when ppDataStart and pDataLength is set in the function. <table class="doxtable">
<tr>
<td colspan="20">pLine </td></tr>
<tr>
<td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td><td>18</td><td>19 </td></tr>
<tr>
<td>+</td><td>Q</td><td>I</td><td>R</td><td>D</td><td>:</td><td>&#160;&#160;</td><td>4</td><td>\r</td><td>\n</td><td>t</td><td>e</td><td>s</td><td>t</td><td>\r</td><td>\n</td><td>O</td><td>K</td><td>\r</td><td>\n </td></tr>
<tr>
<td colspan="10"></td><td colspan="10">^ ppDataStart point to this address in pLine<br  />
with pDataLength is set to 4. </td></tr>
</table>
The binary data will be stored in the response and passed to the AT command response callback function.</li>
<li><b>CELLULAR_PKT_STATUS_SIZE_MISMATCH</b> : The callback function needs more data to decide the start and length of the binary data.</li>
<li><b>Other error</b> : Indicate that the moden returns unexpected response.</li>
</ul>
<p>Cellular interface library calls the response callback function, _Cellular_RecvFuncData in this example, when it successfully receives the binary data from cellular modem. The <a class="el" href="struct_cellular_a_t_command_response__t.html">CellularATCommandResponse_t</a> pAtResp parameter of _Cellular_RecvFuncData contains the following list in this example: </p><div class="fragment"><div class="line">Structure    | <a class="code hl_struct" href="struct_cellular_a_t_command_response__t.html">CellularATCommandResponse_t</a>     <a class="code hl_struct" href="struct_cellular_a_t_command_line__t.html">CellularATCommandLine_t</a>      <a class="code hl_struct" href="struct_cellular_a_t_command_line__t.html">CellularATCommandLine_t</a></div>
<div class="line">Name         | pAtResp                         pAtResp-&gt;pItm                pAtResp-&gt;<a class="code hl_variable" href="struct_cellular_a_t_command_line__t.html#a7137878408ca6595635b2c4c2639b1ac">pNext</a>-&gt;pItm</div>
<div class="line">-------------| ---------------------------     -------------------------    -------------------------</div>
<div class="line">Member       | pItm                         -&gt; pNext                     -&gt; pNext</div>
<div class="line">             |                                 pLine = <span class="stringliteral">&quot;+QIRD: 4&quot;</span>           pLine = <span class="stringliteral">&quot;test&quot;</span></div>
<div class="ttc" id="astruct_cellular_a_t_command_line__t_html"><div class="ttname"><a href="struct_cellular_a_t_command_line__t.html">CellularATCommandLine_t</a></div><div class="ttdoc">Represents A singly-lined list of intermediate AT responses.</div><div class="ttdef"><b>Definition:</b> cellular_types.h:473</div></div>
<div class="ttc" id="astruct_cellular_a_t_command_line__t_html_a7137878408ca6595635b2c4c2639b1ac"><div class="ttname"><a href="struct_cellular_a_t_command_line__t.html#a7137878408ca6595635b2c4c2639b1ac">CellularATCommandLine_t::pNext</a></div><div class="ttdeci">struct CellularATCommandLine * pNext</div><div class="ttdef"><b>Definition:</b> cellular_types.h:474</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
